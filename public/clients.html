<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Clients | TrustGig</title>
    <style>
        :root { --primary: #1e3a8a; --sidebar: #0f172a; --bg: #f8fafc; --text: #334155; --accent: #3b82f6; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background-color: var(--sidebar); color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-size: 1.5rem; font-weight: bold; border-bottom: 1px solid #1e293b; }
        .nav-links { flex: 1; padding: 20px 0; display: flex; flex-direction: column; gap: 5px; }
        .nav-link { padding: 12px 25px; color: #cbd5e1; text-decoration: none; display: flex; align-items: center; gap: 15px; font-weight: 500; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { background-color: var(--primary); color: white; border-left: 4px solid var(--accent); }
        
        /* MAIN */
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h1 { margin: 0; color: #0f172a; font-size: 2rem; }
        
        .grid-layout { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
        
        /* ADD CARD */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .card h3 { margin-top: 0; color: #1e293b; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 20px; }
        
        input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 1rem; margin-bottom: 15px; background: #f8fafc; }
        input:focus { border-color: var(--accent); outline: none; background: white; }
        
        .btn-add { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-add:hover { background: #2563eb; }

        /* LIST CARD */
        .client-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f1f5f9; transition: 0.2s; }
        .client-item:hover { background: #f8fafc; }
        .client-item:last-child { border-bottom: none; }
        .c-icon { background: #dbeafe; color: #1e40af; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; margin-right: 15px; }
        .c-info { flex: 1; }
        .c-name { font-weight: bold; color: #0f172a; font-size: 1.1rem; }
        .c-meta { color: #64748b; font-size: 0.85rem; }
        .btn-del { background: #fee2e2; color: #dc2626; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-del:hover { background: #fca5a5; }

    </style>
    <script>if (sessionStorage.getItem('role') !== 'owner') window.location.href = 'login.html';</script>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">üõ°Ô∏è TrustGig</div>
        <nav class="nav-links">
            <a href="index.html" class="nav-link">üìä Dashboard</a>
            <a href="owner_inbox.html" class="nav-link">üì´ Photo Inbox</a>
            <a href="reports.html" class="nav-link">üßæ Invoices & Links</a>
            <a href="clients.html" class="nav-link active">üè¢ Manage Clients</a>
            <a href="add_worker.html" class="nav-link">üë∑ Add Worker</a>
        </nav>
    </aside>

    <main class="main-content">
        <div class="header">
            <h1>Client Database</h1>
        </div>

        <div class="grid-layout">
            <div class="card" style="height: fit-content;">
                <h3>‚ûï Add New Client</h3>
                <input type="text" id="c-name" placeholder="Company / Client Name">
                <input type="email" id="c-email" placeholder="Email Address">
                <input type="tel" id="c-phone" placeholder="Phone Number">
                <button class="btn-add" onclick="addClient()">Register Client</button>
            </div>

            <div class="card">
                <h3>üè¢ Active Clients</h3>
                <div id="loading" style="color:#64748b; text-align:center;">Loading database...</div>
                <div id="client-list"></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { db, collection, addDoc, getDocs, deleteDoc, doc } from './db.js';

        async function loadClients() {
            const list = document.getElementById('client-list');
            document.getElementById('loading').style.display = 'none';
            list.innerHTML = '';

            try {
                const snap = await getDocs(collection(db, "clients"));
                if(snap.empty) { list.innerHTML = "<p style='color:#64748b;'>No clients found.</p>"; return; }

                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    const initial = data.name.charAt(0).toUpperCase();
                    list.innerHTML += `
                        <div class="client-item">
                            <div class="c-icon">${initial}</div>
                            <div class="c-info">
                                <div class="c-name">${data.name}</div>
                                <div class="c-meta">${data.email || 'No email'} ‚Ä¢ ${data.phone || 'No phone'}</div>
                            </div>
                            <button class="btn-del" onclick="window.delClient('${docSnap.id}')">Delete</button>
                        </div>
                    `;
                });
            } catch(e) { console.error(e); }
        }

        window.addClient = async function() {
            const name = document.getElementById('c-name').value;
            const email = document.getElementById('c-email').value;
            const phone = document.getElementById('c-phone').value;
            if(!name) return alert("Client Name is required!");

            try {
                await addDoc(collection(db, "clients"), { name, email, phone });
                document.getElementById('c-name').value = '';
                document.getElementById('c-email').value = '';
                document.getElementById('c-phone').value = '';
                loadClients();
            } catch(e) { alert("Error: " + e.message); }
        }

        window.delClient = async function(id) {
            if(confirm("Delete this client?")) {
                await deleteDoc(doc(db, "clients", id));
                loadClients();
            }
        }

        loadClients();
    </script>
</body>
</html>